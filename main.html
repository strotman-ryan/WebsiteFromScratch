<html>
<head>
	<title>Ryan's website</title>
</head>
<style>
  div.text{
  float:left;
  margin:5;
  color:black;
  }
  div.time{
  margin:5;
  float:left;
  color:gray;
  }
  div.message{
  margin:10 60 10 60;
  overflow:hidden;
  border-style: solid;
  border-color: green;
  border-radius: 10px;
  }
</style>
<body>
  <!--
  <form action="/" method="POST">
    <label for="message">Add a message:</label><br>
    <input type="text" id="message" name="Message" value=""><br><br>
    <input type="submit" value="Submit">
  </form> -->
  <label>Add a message:</label><br>
  <input type="text" id="message" value=""><br>
  <br>
  <button name="submit" onclick="SendMessage()">Submit</button>

  <div id="allMessages">
  {% for time, message in messages  %}
  <div class="message" >
    <div class="time">{{time}}:</div>
    <div class="text"> {{message}} </div>
  </div>
  {% endfor %}
  </div>

  <script>

    //var uri = "ws://" + "{{ipAddress}}" + ':' + "{{portNum}}" + "/";
    var uri = "ws://127.0.0.1:1025/";
    console.log(uri);
    var ws = new WebSocket(uri);

    ws.onmessage = function (e){
      console.log(e.data)
      jsonObj = JSON.parse(e.data);
        for(var i = 0; i < jsonObj.length; i++){
          var temp = document.getElementById("allMessages");
          var div = document.createElement('div');
          div.className = "message";
          var timeDiv = document.createElement('div');
          timeDiv.className = "time";
          timeDiv.innerHTML = jsonObj[i]['time'];
          var messageDiv = document.createElement('div');
          messageDiv.className = "text";
          messageDiv.innerHTML = jsonObj[i]['message']
          div.appendChild(timeDiv);
          div.appendChild(messageDiv);
          temp.prepend(div);
        }
    }

    function SendMessage(){
      var message = document.getElementById('message').value
      console.log(message)
      message.value = "";
      ws.send(message);
    }

</script>  
  
</body>
</html>
